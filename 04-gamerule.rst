游戏规则
=========

到了这一步了，想必你已经尝试过借鉴许多已有的代码，或者自己动手编写Lua了。
然而，若想真正理解游戏拓展背后本质，则需要先厘清代码背后的内在逻辑——也就是游戏规则。

本节我们尽可能的抛开代码，并对三国杀的游戏规则进行快速的总览。当然，
新月杀实现的游戏规则并不一定和三国杀规则集中所述的那样严丝合缝，但大体上是符合的。

事件
-----

事件指的是若干个相关流程的总和。像是角色使用牌、发动一个技能、造成1点伤害，都会产生一个事件。

在新月杀中，事件概念是为了实现“终止结算”而设计出的概念。（终止结算见于已经隐藏在历史深渊\
的老朱然以及移动版皇甫嵩）也就是说，任何事件都是能被中途停止的——所谓的终止结算。

结算指的是处理一个事件的过程。从代码角度而言，就是事件函数体内所要执行的代码。
（假设把事件看成一个函数的话）

在新月杀中，各类游戏事件大致被分为以下几类：

1. 体力类（伤害事件、失去体力事件等）
2. 游戏流程类（轮次事件、回合事件等）
3. 死亡相关（濒死事件、阵亡事件等）
4. 使用卡牌事件
5. 移动卡牌事件
6. 其他事件

使用牌和移动牌毫无疑问是理解起来难度最大的事件，无论是从规则集看还是从代码看。

想要写出正确的代码，理解相关事件内在逻辑是必不可少的。拿伤害事件而言，你至少要知道\
寒冰剑和小乔的“天香”应该先触发哪种。在之后章节的讲述中，会先解释事件在规则集层面的\
执行流程，再来详细查看代码该怎么编写（如何产生事件以及如何利用事件相关的时机）。

时机
-----

时机指的是一个瞬间，一个事件发生时会产生若干个时机。一个事件中的所有时机是按照顺序\
生成并进行处理的。

规则集中对于相关触发时机如何处理并未详细介绍（他直接罗列某个时机能触发的所有技能，\
这对于能无限拓展的新月杀怎么可能做得到呢），因此有必要介绍触发时机的处理办法。

如规则集所言，时机相关的操作分为生成时机和处理时机。生成时机很简单（我们写技能一般\
也用不着），而处理时机则有一个相当复杂的流程。在“触发技”章节中这个流程会更加详细的\
说明，但是这里依然需要简单提一下。

1. 触发了某个时机。
2. 从当前回合的角色开始，依次遍历所有角色。
3. 若遍历到的角色含有在当前时机已经满足触发条件的技能，则触发该技能。
4. “触发该技能”指的是先询问执行技能的消耗（如果有），如果通过了就执行技能的效果。
5. 所有角色全部遍历完之后，这个触发时机的处理也就结束了。

触发时机会引发某些触发技生效。而事件则是包含一系列触发时机的具体结算流程。

游戏流程
---------

游戏的流程为：

1. 选将，根据不同游戏模式而不同。
2. 从一号位开始无限的依次执行回合事件。

当游戏结束时，无限循环就被打断了，此时游戏流程也宣告结束。

技能
-----

技能的本质是携带了一系列自定义函数的表。这些自定义函数分别指明技能的条件、效果等。

新月杀中万事万物皆是技能。卡牌也一样，它是一个主动技的套壳形式，本质上效果是由主动技完成的。

之前已经提过技能的类型：状态类技能和可发动类技能。相较于规则集的分类，还新增了“主动技”\
和“视为技”，分别用来实现主动效果和卡牌转化。

触发技又可以进一步分出“效果类技能”。这里所谓的“效果”是指那种不会产生技能使用事件、亦不会\
计入技能发动次数的代码。

游戏牌
-------

游戏牌指的是诸如【杀】、【闪】之类的可以成为手牌的牌。与武将牌的概念相对应。

新月杀目前没有武将牌的概念，但游戏牌肯定有。毕竟涉及到移牌和使用牌这种基本操作。

衍生牌指的是由技能衍生出来的牌（例如蒲元的各种阴间武器）。这些牌平时放在游戏外而不是洗入牌堆，\
等到有需要的时候才会启用。

转化牌指的是由技能转化的牌\ **以及虚拟牌**\ 。这点与规则集有出入。

小结
-----

本节中大致的对一些核心概念进行了总览。而作为重点的事件结算流程，也将在后续的章节中慢慢解释。
